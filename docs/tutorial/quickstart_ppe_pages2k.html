

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>A Pseudoproxy Experiment with GraphEM and pseudoPAGES2k &mdash; GraphEM  documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "document", "processHtmlClass": "math|output_area"}}</script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Reconstruction using GraphEM" href="quickstart_recon.html" />
    <link rel="prev" title="A Pseudoproxy Experiment with GraphEM" href="quickstart_ppe.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> GraphEM
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../tutorial.html">Tutorial</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../tutorial.html#quickstart">Quickstart</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="quickstart_solver.html">A quickstart of the GraphEM solver</a></li>
<li class="toctree-l3"><a class="reference internal" href="quickstart_ppe.html">A Pseudoproxy Experiment with GraphEM</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">A Pseudoproxy Experiment with GraphEM and pseudoPAGES2k</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Test-data-preparation">Test data preparation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Reconstruction">Reconstruction</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Validation">Validation</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="quickstart_recon.html">Reconstruction using GraphEM</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../api.html">API</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">GraphEM</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../tutorial.html">Tutorial</a> &raquo;</li>
        
      <li>A Pseudoproxy Experiment with GraphEM and pseudoPAGES2k</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/tutorial/quickstart_ppe_pages2k.ipynb.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="A-Pseudoproxy-Experiment-with-GraphEM-and-pseudoPAGES2k">
<h1>A Pseudoproxy Experiment with GraphEM and pseudoPAGES2k<a class="headerlink" href="#A-Pseudoproxy-Experiment-with-GraphEM-and-pseudoPAGES2k" title="Permalink to this headline">¶</a></h1>
<p><strong>Expected time to run through: 10 mins</strong></p>
<p>This tutorial demonstrates how to get a reconstruction using GraphEM, leveraging a simple pseudoproxy dataset generated from iCESM gridded, with the realistic spatiotemporal availability of the PAGES2kv2 dataset. The pseudoproxy are generated based on the original iCESM simulated <code class="docutils literal notranslate"><span class="pre">tas</span></code> plus white noise with <code class="docutils literal notranslate"><span class="pre">SNR=1</span></code>, using below code block:</p>
<div class="section" id="Test-data-preparation">
<h2>Test data preparation<a class="headerlink" href="#Test-data-preparation" title="Permalink to this headline">¶</a></h2>
<p>To go through this tutorial, please prepare test data following the steps:</p>
<p>Download the test case named “PPE_PAGES2k” with this <a class="reference external" href="https://drive.google.com/drive/folders/1_h6o_gDR6xLX50c_Ad-lzRoWwHlAgBnK?usp=sharing">link</a>. Create a directory named “testcases” in the same directory where this notebook sits. Put the unzipped direcotry “PPE_PAGES2k” into “testcases”.</p>
<p>Below, we first load some useful packages, including our <code class="docutils literal notranslate"><span class="pre">GraphEM</span></code>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">%</span><span class="k">load_ext</span> autoreload
<span class="o">%</span><span class="k">autoreload</span> 2

<span class="kn">import</span> <span class="nn">LMRt</span>
<span class="kn">import</span> <span class="nn">GraphEM</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">xarray</span> <span class="k">as</span> <span class="nn">xr</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span>  <span class="nn">plt</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Reconstruction">
<h2>Reconstruction<a class="headerlink" href="#Reconstruction" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">job</span> <span class="o">=</span> <span class="n">GraphEM</span><span class="o">.</span><span class="n">ReconJob</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">job</span><span class="o">.</span><span class="n">load_configs</span><span class="p">(</span><span class="s1">&#39;./testcases/PPE_PAGES2k/configs.yml&#39;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-cyan-intense-fg ansi-bold">GraphEM: job.load_configs() &gt;&gt;&gt; loading reconstruction configurations from: ./testcases/PPE_PAGES2k/configs.yml</span>
<span class="ansi-green-intense-fg ansi-bold">GraphEM: job.load_configs() &gt;&gt;&gt; job.configs created</span>
<span class="ansi-cyan-intense-fg ansi-bold">GraphEM: job.load_configs() &gt;&gt;&gt; job.configs[&#34;job_dirpath&#34;] = /Users/fzhu/Github/GraphEM/docsrc/tutorial/testcases/PPE_PAGES2k/recon</span>
<span class="ansi-green-intense-fg ansi-bold">GraphEM: job.load_configs() &gt;&gt;&gt; /Users/fzhu/Github/GraphEM/docsrc/tutorial/testcases/PPE_PAGES2k/recon created</span>
{&#39;anom_period&#39;: [1951, 1980],
 &#39;calib_period&#39;: [1900, 2000],
 &#39;job_dirpath&#39;: &#39;/Users/fzhu/Github/GraphEM/docsrc/tutorial/testcases/PPE_PAGES2k/recon&#39;,
 &#39;job_id&#39;: &#39;GraphEM_tutorial&#39;,
 &#39;obs_path&#39;: {&#39;tas&#39;: &#39;./data/obs/iCESM_ann.nc&#39;},
 &#39;obs_regrid_ntrunc&#39;: 21,
 &#39;obs_varname&#39;: {&#39;lat&#39;: &#39;lat&#39;, &#39;lon&#39;: &#39;lon&#39;, &#39;tas&#39;: &#39;tas&#39;},
 &#39;proxydb_path&#39;: &#39;./data/proxy/pseudoPAGES2k_dataset_tas_wn_full_temporal_availability.pkl&#39;,
 &#39;ptype_list&#39;: &#39;all&#39;,
 &#39;recon_period&#39;: [1000, 2000]}
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">job</span><span class="o">.</span><span class="n">load_proxydb</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-cyan-intense-fg ansi-bold">GraphEM: job.load_proxydb() &gt;&gt;&gt; job.configs[&#34;proxydb_path&#34;] = /Users/fzhu/Github/GraphEM/docsrc/tutorial/testcases/PPE_PAGES2k/data/proxy/pseudoPAGES2k_dataset_tas_wn_full_temporal_availability.pkl</span>
<span class="ansi-green-intense-fg ansi-bold">GraphEM: job.load_proxydb() &gt;&gt;&gt; 692 records loaded</span>
<span class="ansi-green-intense-fg ansi-bold">GraphEM: job.load_proxydb() &gt;&gt;&gt; job.proxydb created</span>
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">job</span><span class="o">.</span><span class="n">proxydb</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_quickstart_ppe_pages2k_8_0.png" src="../_images/tutorial_quickstart_ppe_pages2k_8_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">job</span><span class="o">.</span><span class="n">load_obs</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">obs</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-cyan-intense-fg ansi-bold">GraphEM: job.load_obs() &gt;&gt;&gt; loading instrumental observation fields from: {&#39;tas&#39;: &#39;/Users/fzhu/Github/GraphEM/docsrc/tutorial/testcases/PPE_PAGES2k/data/obs/iCESM_ann.nc&#39;}</span>
<span class="ansi-green-intense-fg ansi-bold">GraphEM: job.load_obs() &gt;&gt;&gt; job.obs created</span>
Dataset Overview
-----------------------

     Name:  tas
   Source:  /Users/fzhu/Github/GraphEM/docsrc/tutorial/testcases/PPE_PAGES2k/data/obs/iCESM_ann.nc
    Shape:  time:1156, lat:96, lon:144
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># regrid obs to make the problem size smaller</span>
<span class="n">job</span><span class="o">.</span><span class="n">regrid_obs</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-black-intense-fg ansi-bold">LMRt: job.regrid_obs() &gt;&gt;&gt; regridded obs</span>
Dataset Overview
-----------------------

     Name:  tas
   Source:  /Users/fzhu/Github/GraphEM/docsrc/tutorial/testcases/PPE_PAGES2k/data/obs/iCESM_ann.nc
    Shape:  time:1156, lat:22, lon:33
<span class="ansi-green-intense-fg ansi-bold">LMRt: job.regrid_obs() &gt;&gt;&gt; job.obs updated</span>
</pre></div></div>
</div>
<p>Since the loaded iCESM simulation and the pseudoproxy dataset are already annualized, we can skip the <code class="docutils literal notranslate"><span class="pre">.seasonalize()</span></code> steps and run <code class="docutils literal notranslate"><span class="pre">.prep_data()</span></code> directly.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">job</span><span class="o">.</span><span class="n">prep_data</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-green-intense-fg ansi-bold">GraphEM: job.prep_data() &gt;&gt;&gt; job.recon_time created</span>
<span class="ansi-green-intense-fg ansi-bold">GraphEM: job.prep_data() &gt;&gt;&gt; job.calib_time created</span>
<span class="ansi-green-intense-fg ansi-bold">GraphEM: job.prep_data() &gt;&gt;&gt; job.calib_idx created</span>
<span class="ansi-green-intense-fg ansi-bold">GraphEM: job.prep_data() &gt;&gt;&gt; job.temp created</span>
<span class="ansi-green-intense-fg ansi-bold">GraphEM: job.prep_data() &gt;&gt;&gt; job.df_proxy created</span>
<span class="ansi-green-intense-fg ansi-bold">GraphEM: job.prep_data() &gt;&gt;&gt; job.proxy created</span>
<span class="ansi-green-intense-fg ansi-bold">GraphEM: job.prep_data() &gt;&gt;&gt; job.lonlat created</span>
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">job</span><span class="o">.</span><span class="n">df_proxy</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>NAm_153</th>
      <th>Asi_245</th>
      <th>NAm_165</th>
      <th>Asi_178</th>
      <th>Asi_174</th>
      <th>Eur_016</th>
      <th>Asi_198</th>
      <th>NAm_145</th>
      <th>Arc_070</th>
      <th>Arc_071</th>
      <th>...</th>
      <th>Asi_119</th>
      <th>Ocn_153</th>
      <th>NAm_074</th>
      <th>Asi_026</th>
      <th>Ocn_169</th>
      <th>Asi_201</th>
      <th>Asi_179</th>
      <th>Arc_014</th>
      <th>Ocn_071</th>
      <th>Ocn_072</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1000.0</th>
      <td>1.991316</td>
      <td>1.076783</td>
      <td>0.410502</td>
      <td>-0.173932</td>
      <td>0.202598</td>
      <td>1.351549</td>
      <td>-0.460631</td>
      <td>1.628941</td>
      <td>1.370160</td>
      <td>1.164753</td>
      <td>...</td>
      <td>0.808244</td>
      <td>0.282663</td>
      <td>1.117257</td>
      <td>0.799945</td>
      <td>0.155647</td>
      <td>-0.931838</td>
      <td>-0.086837</td>
      <td>-0.035836</td>
      <td>-0.421204</td>
      <td>0.792450</td>
    </tr>
    <tr>
      <th>1001.0</th>
      <td>1.474484</td>
      <td>-0.308733</td>
      <td>0.249446</td>
      <td>0.598656</td>
      <td>-0.056904</td>
      <td>0.137913</td>
      <td>0.376916</td>
      <td>-3.876324</td>
      <td>-1.509714</td>
      <td>2.864117</td>
      <td>...</td>
      <td>0.542854</td>
      <td>-0.138603</td>
      <td>2.097570</td>
      <td>0.012348</td>
      <td>-0.525504</td>
      <td>-1.882890</td>
      <td>0.717570</td>
      <td>1.830759</td>
      <td>-1.086185</td>
      <td>-0.031783</td>
    </tr>
    <tr>
      <th>1002.0</th>
      <td>-1.749010</td>
      <td>0.078419</td>
      <td>-1.069865</td>
      <td>-1.118535</td>
      <td>-0.339929</td>
      <td>-0.475327</td>
      <td>2.033267</td>
      <td>0.087343</td>
      <td>0.360542</td>
      <td>-2.410067</td>
      <td>...</td>
      <td>-0.461850</td>
      <td>-0.454381</td>
      <td>-1.528630</td>
      <td>0.882063</td>
      <td>-0.135203</td>
      <td>-0.621540</td>
      <td>-0.043420</td>
      <td>-0.330917</td>
      <td>-0.577220</td>
      <td>-0.124923</td>
    </tr>
    <tr>
      <th>1003.0</th>
      <td>0.217035</td>
      <td>1.674967</td>
      <td>-1.750278</td>
      <td>-0.575866</td>
      <td>0.136504</td>
      <td>0.781710</td>
      <td>1.011006</td>
      <td>2.542533</td>
      <td>-1.087626</td>
      <td>-0.919410</td>
      <td>...</td>
      <td>0.031054</td>
      <td>0.438249</td>
      <td>1.705930</td>
      <td>-0.225784</td>
      <td>0.544517</td>
      <td>-0.056655</td>
      <td>0.483183</td>
      <td>-0.960525</td>
      <td>0.207954</td>
      <td>0.649017</td>
    </tr>
    <tr>
      <th>1004.0</th>
      <td>0.209092</td>
      <td>0.179273</td>
      <td>1.226517</td>
      <td>-0.167719</td>
      <td>0.824626</td>
      <td>-0.052601</td>
      <td>2.230018</td>
      <td>1.007028</td>
      <td>-1.957817</td>
      <td>2.547536</td>
      <td>...</td>
      <td>-0.124999</td>
      <td>-0.354393</td>
      <td>-0.472327</td>
      <td>0.725839</td>
      <td>-0.056934</td>
      <td>1.691067</td>
      <td>-0.086595</td>
      <td>-1.855176</td>
      <td>0.066563</td>
      <td>-0.316830</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>1996.0</th>
      <td>0.451554</td>
      <td>-0.012429</td>
      <td>-0.483565</td>
      <td>-1.308976</td>
      <td>-0.431576</td>
      <td>-0.061208</td>
      <td>2.699160</td>
      <td>3.148305</td>
      <td>1.170936</td>
      <td>-0.781837</td>
      <td>...</td>
      <td>0.033587</td>
      <td>0.786702</td>
      <td>0.344960</td>
      <td>-0.690816</td>
      <td>0.565884</td>
      <td>0.758542</td>
      <td>-0.395638</td>
      <td>0.221436</td>
      <td>0.532183</td>
      <td>0.780281</td>
    </tr>
    <tr>
      <th>1997.0</th>
      <td>0.593906</td>
      <td>-0.391556</td>
      <td>1.189919</td>
      <td>-0.983018</td>
      <td>-0.086014</td>
      <td>0.744214</td>
      <td>1.883391</td>
      <td>-0.916550</td>
      <td>-1.326753</td>
      <td>0.781728</td>
      <td>...</td>
      <td>-0.087708</td>
      <td>0.080720</td>
      <td>-0.069768</td>
      <td>-0.437823</td>
      <td>-0.329610</td>
      <td>-0.499093</td>
      <td>-0.083515</td>
      <td>-1.862747</td>
      <td>-0.084249</td>
      <td>-0.521903</td>
    </tr>
    <tr>
      <th>1998.0</th>
      <td>1.543173</td>
      <td>-0.586401</td>
      <td>0.886359</td>
      <td>0.631522</td>
      <td>0.272213</td>
      <td>0.101556</td>
      <td>-0.464913</td>
      <td>0.124083</td>
      <td>3.749645</td>
      <td>2.468217</td>
      <td>...</td>
      <td>-0.591060</td>
      <td>0.393950</td>
      <td>1.165156</td>
      <td>0.295951</td>
      <td>-0.324858</td>
      <td>0.856186</td>
      <td>0.527396</td>
      <td>2.117025</td>
      <td>0.006060</td>
      <td>0.662496</td>
    </tr>
    <tr>
      <th>1999.0</th>
      <td>1.311804</td>
      <td>-0.147377</td>
      <td>0.121918</td>
      <td>0.649256</td>
      <td>-0.359322</td>
      <td>-0.908425</td>
      <td>0.380988</td>
      <td>2.338570</td>
      <td>2.703852</td>
      <td>0.715449</td>
      <td>...</td>
      <td>0.381650</td>
      <td>0.259597</td>
      <td>0.473400</td>
      <td>0.211626</td>
      <td>-0.041561</td>
      <td>-0.057345</td>
      <td>-0.231382</td>
      <td>0.319323</td>
      <td>1.100090</td>
      <td>0.053861</td>
    </tr>
    <tr>
      <th>2000.0</th>
      <td>-0.256298</td>
      <td>-0.598022</td>
      <td>-0.027015</td>
      <td>0.985057</td>
      <td>1.122260</td>
      <td>1.475932</td>
      <td>1.167360</td>
      <td>0.226961</td>
      <td>1.167712</td>
      <td>-0.492571</td>
      <td>...</td>
      <td>-0.081461</td>
      <td>0.500858</td>
      <td>0.639752</td>
      <td>-0.158313</td>
      <td>-0.036536</td>
      <td>0.374727</td>
      <td>-0.002639</td>
      <td>1.969362</td>
      <td>0.640155</td>
      <td>0.180584</td>
    </tr>
  </tbody>
</table>
<p>1001 rows × 692 columns</p>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">temp</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">proxy</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">lonlat</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(1001, 726)
(1001, 692)
(1418, 2)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">job</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-cyan-intense-fg ansi-bold">LMRt: job.save_job() &gt;&gt;&gt; Prepration data saved to: /Users/fzhu/Github/GraphEM/docsrc/tutorial/testcases/PPE_PAGES2k/recon/job.pkl</span>
<span class="ansi-cyan-intense-fg ansi-bold">LMRt: job.save_job() &gt;&gt;&gt; job.configs[&#34;prep_savepath&#34;] = /Users/fzhu/Github/GraphEM/docsrc/tutorial/testcases/PPE_PAGES2k/recon/job.pkl</span>
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">%%time</span>

<span class="c1"># need to remove G.pkl if the previous run is problematic</span>
<span class="n">save_path</span> <span class="o">=</span> <span class="s1">&#39;./testcases/PPE_PAGES2k/recon/G.pkl&#39;</span>
<span class="n">job</span><span class="o">.</span><span class="n">run_solver</span><span class="p">(</span><span class="n">save_path</span><span class="o">=</span><span class="n">save_path</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Estimating graph using neighborhood method
Running GraphEM:

Iter     dXmis     rdXmis

001     0.0982     0.7515
002     0.1367     0.8326
003     0.1295     0.7656
004     0.1024     0.3950
005     0.0741     0.2227
006     0.0617     0.1605
007     0.0534     0.1254
008     0.0474     0.1023
009     0.0437     0.0877
010     0.0414     0.0778
011     0.0401     0.0711
012     0.0394     0.0662
013     0.0389     0.0621
014     0.0388     0.0591
015     0.0389     0.0565
016     0.0391     0.0544
017     0.0398     0.0531
018     0.0405     0.0517
019     0.0416     0.0509
020     0.0424     0.0499
021     0.0430     0.0486
022     0.0434     0.0472
023     0.0435     0.0456
024     0.0438     0.0443
025     0.0433     0.0422
026     0.0428     0.0404
027     0.0423     0.0386
028     0.0417     0.0370
029     0.0405     0.0349
030     0.0397     0.0332
031     0.0388     0.0317
032     0.0380     0.0303
033     0.0366     0.0284
034     0.0355     0.0270
035     0.0353     0.0262
036     0.0338     0.0247
037     0.0321     0.0229
038     0.0315     0.0221
039     0.0309     0.0213
040     0.0302     0.0205
041     0.0285     0.0190
042     0.0284     0.0187
043     0.0270     0.0175
044     0.0270     0.0173
045     0.0256     0.0162
046     0.0248     0.0154
047     0.0253     0.0155
048     0.0239     0.0145
049     0.0232     0.0139
050     0.0226     0.0134
051     0.0222     0.0130
052     0.0230     0.0133
053     0.0217     0.0125
054     0.0210     0.0120
055     0.0205     0.0116
056     0.0201     0.0113
057     0.0198     0.0110
058     0.0209     0.0115
059     0.0195     0.0106
060     0.0188     0.0102
061     0.0183     0.0098
062     0.0180     0.0096
063     0.0177     0.0093
064     0.0174     0.0091
065     0.0171     0.0089
066     0.0169     0.0087
067     0.0167     0.0086
068     0.0165     0.0084
069     0.0183     0.0093
070     0.0165     0.0083
071     0.0158     0.0079
072     0.0154     0.0076
073     0.0150     0.0074
074     0.0148     0.0073
075     0.0146     0.0071
076     0.0144     0.0070
077     0.0142     0.0069
078     0.0141     0.0068
079     0.0139     0.0067
080     0.0138     0.0066
081     0.0136     0.0065
082     0.0135     0.0064
083     0.0134     0.0063
084     0.0133     0.0062
085     0.0132     0.0061
086     0.0131     0.0060
087     0.0129     0.0060
088     0.0128     0.0059
089     0.0160     0.0073
090     0.0137     0.0062
091     0.0147     0.0067
092     0.0136     0.0062
093     0.0142     0.0064
094     0.0123     0.0055
095     0.0117     0.0052
096     0.0114     0.0051
097     0.0112     0.0050
<span class="ansi-green-intense-fg ansi-bold">GraphEM: job.run_solver() &gt;&gt;&gt; job.G created and saved to: ./testcases/PPE_PAGES2k/recon/G.pkl</span>
<span class="ansi-green-intense-fg ansi-bold">GraphEM: job.run_solver() &gt;&gt;&gt; job.recon created</span>
CPU times: user 3h 50min 7s, sys: 3min 52s, total: 3h 54min
Wall time: 31min 37s
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">job</span><span class="o">.</span><span class="n">save_recon</span><span class="p">(</span><span class="s1">&#39;./testcases/PPE_PAGES2k/recon/recon.nc&#39;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-cyan-intense-fg ansi-bold">LMRt: job.save_recon() &gt;&gt;&gt; Reconstruction saved to: ./testcases/PPE_PAGES2k/recon/recon.nc</span>
</pre></div></div>
</div>
</div>
<div class="section" id="Validation">
<h2>Validation<a class="headerlink" href="#Validation" title="Permalink to this headline">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">with</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="s1">&#39;./testcases/PPE_PAGES2k/recon/recon.nc&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">ds</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">ds</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;xarray.Dataset&gt;
Dimensions:  (lat: 22, lon: 33, year: 1001)
Coordinates:
  * year     (year) int64 1000 1001 1002 1003 1004 ... 1996 1997 1998 1999 2000
  * lat      (lat) float64 -85.91 -77.73 -69.55 -61.36 ... 69.55 77.73 85.91
  * lon      (lon) float64 0.0 10.91 21.82 32.73 ... 316.4 327.3 338.2 349.1
Data variables:
    recon    (year, lat, lon) float64 ...
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">target</span> <span class="o">=</span> <span class="n">job</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;tas&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">[:</span><span class="mi">1001</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">target</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(1001, 22, 33)
</pre></div></div>
</div>
<div class="section" id="Mean-Statistics">
<h3>Mean Statistics<a class="headerlink" href="#Mean-Statistics" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">nt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">ds</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">])</span>
<span class="n">temp_r</span> <span class="o">=</span> <span class="n">job</span><span class="o">.</span><span class="n">recon</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">nt</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
<span class="n">V</span> <span class="o">=</span> <span class="n">GraphEM</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">verif_stats</span><span class="p">(</span><span class="n">temp_r</span><span class="p">,</span> <span class="n">target</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">nt</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)),</span> <span class="n">job</span><span class="o">.</span><span class="n">calib_idx</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">V</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Mean MSE = 5.5593, Mean RE = -5.1086, Mean CE = -5.7476, Mean R2 = 0.0014
</pre></div></div>
</div>
</div>
<div class="section" id="Map-of-CE">
<h3>Map of CE<a class="headerlink" href="#Map-of-CE" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">ce</span> <span class="o">=</span> <span class="n">LMRt</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">coefficient_efficiency</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;recon&#39;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">ce</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(22, 33)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">cartopy.crs</span> <span class="k">as</span> <span class="nn">ccrs</span>
<span class="kn">import</span> <span class="nn">cartopy.feature</span> <span class="k">as</span> <span class="nn">cfeature</span>
<span class="kn">from</span> <span class="nn">cartopy.mpl.ticker</span> <span class="kn">import</span> <span class="n">LongitudeFormatter</span><span class="p">,</span> <span class="n">LatitudeFormatter</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(</span><span class="n">central_longitude</span><span class="o">=</span><span class="mi">180</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Coefficient of Efficiency&#39;</span><span class="p">)</span>
<span class="n">latlon_range</span> <span class="o">=</span> <span class="p">[</span><span class="mi">50</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="o">-</span><span class="mi">45</span><span class="p">,</span> <span class="mi">45</span><span class="p">]</span>
<span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">()</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_extent</span><span class="p">(</span><span class="n">latlon_range</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="n">transform</span><span class="p">)</span>
<span class="n">lon_formatter</span> <span class="o">=</span> <span class="n">LongitudeFormatter</span><span class="p">(</span><span class="n">zero_direction_label</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">lat_formatter</span> <span class="o">=</span> <span class="n">LatitudeFormatter</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">lon_formatter</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">lat_formatter</span><span class="p">)</span>

<span class="n">lon_ticks</span><span class="o">=</span><span class="p">[</span><span class="mi">60</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="mi">240</span><span class="p">,</span> <span class="mi">300</span><span class="p">]</span>
<span class="n">lat_ticks</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="o">-</span><span class="mi">45</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">45</span><span class="p">,</span> <span class="mi">90</span><span class="p">]</span>
<span class="n">lon_ticks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">lon_ticks</span><span class="p">)</span>
<span class="n">lat_ticks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">lat_ticks</span><span class="p">)</span>
<span class="n">lon_min</span><span class="p">,</span> <span class="n">lon_max</span><span class="p">,</span> <span class="n">lat_min</span><span class="p">,</span> <span class="n">lat_max</span> <span class="o">=</span> <span class="n">latlon_range</span>
<span class="n">mask_lon</span> <span class="o">=</span> <span class="p">(</span><span class="n">lon_ticks</span> <span class="o">&gt;=</span> <span class="n">lon_min</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lon_ticks</span> <span class="o">&lt;=</span> <span class="n">lon_max</span><span class="p">)</span>
<span class="n">mask_lat</span> <span class="o">=</span> <span class="p">(</span><span class="n">lat_ticks</span> <span class="o">&gt;=</span> <span class="n">lat_min</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat_ticks</span> <span class="o">&lt;=</span> <span class="n">lat_max</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">lon_ticks</span><span class="p">[</span><span class="n">mask_lon</span><span class="p">],</span> <span class="n">crs</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">lat_ticks</span><span class="p">[</span><span class="n">mask_lat</span><span class="p">],</span> <span class="n">crs</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>

<span class="n">levels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">21</span><span class="p">)</span>
<span class="n">cbar_labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">11</span><span class="p">)</span>
<span class="n">cbar_title</span> <span class="o">=</span> <span class="s1">&#39;CE&#39;</span>
<span class="n">extend</span> <span class="o">=</span> <span class="s1">&#39;both&#39;</span>
<span class="n">cmap</span> <span class="o">=</span> <span class="s1">&#39;Reds&#39;</span>
<span class="n">cbar_pad</span><span class="o">=</span><span class="mf">0.1</span>
<span class="n">cbar_orientation</span><span class="o">=</span><span class="s1">&#39;horizontal&#39;</span>
<span class="n">cbar_aspect</span><span class="o">=</span><span class="mi">10</span>
<span class="n">cbar_fraction</span><span class="o">=</span><span class="mf">0.35</span>
<span class="n">cbar_shrink</span><span class="o">=</span><span class="mf">0.8</span>
<span class="n">font_scale</span><span class="o">=</span><span class="mf">1.5</span>
<span class="n">land_color</span><span class="o">=</span><span class="n">sns</span><span class="o">.</span><span class="n">xkcd_rgb</span><span class="p">[</span><span class="s1">&#39;light grey&#39;</span><span class="p">]</span>
<span class="n">ocean_color</span><span class="o">=</span><span class="n">sns</span><span class="o">.</span><span class="n">xkcd_rgb</span><span class="p">[</span><span class="s1">&#39;white&#39;</span><span class="p">]</span>

<span class="n">ax</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">cfeature</span><span class="o">.</span><span class="n">LAND</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="n">land_color</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="n">land_color</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">cfeature</span><span class="o">.</span><span class="n">OCEAN</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="n">ocean_color</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="n">ocean_color</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">coastlines</span><span class="p">()</span>
<span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">ds</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">ce</span><span class="p">,</span> <span class="n">levels</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">transform</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">extend</span><span class="o">=</span><span class="n">extend</span><span class="p">)</span>
<span class="n">cbar</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span>
    <span class="n">im</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="n">cbar_orientation</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="n">cbar_pad</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="n">cbar_aspect</span><span class="p">,</span>
    <span class="n">fraction</span><span class="o">=</span><span class="n">cbar_fraction</span><span class="p">,</span> <span class="n">shrink</span><span class="o">=</span><span class="n">cbar_shrink</span><span class="p">)</span>
<span class="n">cbar</span><span class="o">.</span><span class="n">set_ticks</span><span class="p">(</span><span class="n">cbar_labels</span><span class="p">)</span>
<span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">cbar_title</span><span class="p">,</span> <span class="n">x</span><span class="o">=-</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>

<span class="n">LMRt</span><span class="o">.</span><span class="n">showfig</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_quickstart_ppe_pages2k_25_0.png" src="../_images/tutorial_quickstart_ppe_pages2k_25_0.png" />
</div>
</div>
</div>
<div class="section" id="Mean-timeseries">
<h3>Mean timeseries<a class="headerlink" href="#Mean-timeseries" title="Permalink to this headline">¶</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">pyleoclim</span> <span class="k">as</span> <span class="nn">pyleo</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">geo_mean</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">lat</span><span class="p">):</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">),</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">lat</span><span class="p">))</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">m</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">m_target</span> <span class="o">=</span> <span class="n">geo_mean</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;tas&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">[:</span><span class="mi">1001</span><span class="p">],</span> <span class="n">job</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;tas&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lat</span><span class="p">)</span>
<span class="n">ts_target</span> <span class="o">=</span> <span class="n">pyleo</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">job</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;tas&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">time</span><span class="p">[:</span><span class="mi">1001</span><span class="p">],</span> <span class="n">value</span><span class="o">=</span><span class="n">m_target</span><span class="p">)</span>

<span class="n">m_recon</span> <span class="o">=</span> <span class="n">geo_mean</span><span class="p">(</span><span class="n">ds</span><span class="p">[</span><span class="s1">&#39;recon&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
<span class="n">ts_recon</span> <span class="o">=</span> <span class="n">pyleo</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">ds</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">m_recon</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ts_target</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">mute</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;target&#39;</span><span class="p">)</span>
<span class="n">ts_recon</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;recon&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ds</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">m_target</span><span class="o">-</span><span class="n">m_recon</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;diff&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">pyleo</span><span class="o">.</span><span class="n">showfig</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_quickstart_ppe_pages2k_29_0.png" src="../_images/tutorial_quickstart_ppe_pages2k_29_0.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>
</pre></div>
</div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="quickstart_recon.html" class="btn btn-neutral float-right" title="Reconstruction using GraphEM" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="quickstart_ppe.html" class="btn btn-neutral float-left" title="A Pseudoproxy Experiment with GraphEM" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, Feng Zhu, Dominique Guillot, Julien Emile-Geay.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>